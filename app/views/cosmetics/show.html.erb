<nav aria-label="breadcrumb" class="my-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="/">ãƒ›ãƒ¼ãƒ </a>
        </li>
        <li class="breadcrumb-item">
            <a href="/cosmetics/">ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page"><%= @cosmetic.product_name %></li>
    </ol>
</nav>

<div class="row ">
    <div class="col-6">
        <% if @cosmetic.image.attached? %>
        <img src="<%= url_for(@cosmetic.image) %>" class="img-fluid"></div>
    <% else %>
    <img src="https://via.placeholder.com/700x400?text=No+Image" class="img-fluid">
    <% end %>

    <div class="col-6">
        <h3><%= @cosmetic.product_name %></h3>
        <p><%= @cosmetic.desc %></p>
        <hr>
        <h5>èª¬æ˜</h5>
        <p><%= @cosmetic.company_name %></p>
        <hr>
        <h4>å¿…é ˆ<br>ã‚ªãƒƒã‚·ãƒ§ãƒ³ã‚’é¸æŠã™ã‚‹</h4>
        <%# data-remoteã ã‘ã§Ajaxé€šä¿¡ã‚³ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ %>
        <form action="/carts" method="POST" data-remote="true">
            <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
            <input type="hidden" name="cosmetic_id" value="<%= @cosmetic.id %>">
            <div calss="form-group">
                <label for="exampleFormControlSelect1">Example select</label>
                <label for="quantity">æ•°é‡</label>
                <select class="form-control" name="quantity" id="quantity">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
            </div>
            <br>

            <button type="submit" class="btn btn-outline-dark">ã‚«ãƒ¼ãƒˆã«å…¥ã‚Œã‚‹</button>
        </form>
    </div>
</div>

<div class="row">
    <div class="col-12 mt-5">
        <div class="comment-wrapper">
            <div class="panel-heading">
                <div class="panel-body">
                    <form class="comment">
                        <h2>ğŸ’­ ã‚«ã‚¹ã‚¿ãƒãƒ¼ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                        <br>
                        <textarea class="form-control comment-contents" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã„ã¦ãã ã•ã„..."
                            rows="4"></textarea>
                        <br>
                        <button type="submit" class="btn btn-info float-right">ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ®‹ã™</button>
                        </form>
                        <div class="clearfix"></div>
                        <hr>
                        <div class="media-list comment-list">
                        <% @cosmetic.comments.reverse.each do |comment|%>
                            <li class="media comment-<%= comment.id%>">
                                <a href="#" class="pull-left">
                                    <img src="<%= asset_path("profile.png") %>" alt="" class="img-circle">
                                </a>
                                <div class="media-body">
                                    <span class="text-muted pull-right">
                                        <small class="text-muted"><%= time_ago_in_words(comment.created_at) %></small>
                                    </span>
                                    <strong class="text-success"><%= comment.user_email %></strong>
                                    <p>
                                        <span class="comment-detail-<%=comment.id%>"><%= comment.contents %></span>
                                    </p>
                                    <div class="button_edit mb-2">
                                        <button data-id="<%= comment.id %>"
                                            class="btn btn-primary edit-comment">ä¿®æ­£</button>
                                        <button data-id="<%= comment.id %>"
                                            class="btn btn-primary destroy-comment">å‰Šé™¤</button>
                                    </div>
                                </div>
                            </li>
                        <% end %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


    <form action="/cosmetics/<%= @cosmetic.id %>" method="PUT" data-remote="true">
        <div id="star"></div>
        <button type="submit" class="btn btn-outline-dark">Rating</button>
    </form>
</div>

</div>
<script>
    $('#star').raty({
        path: '/images',
        score: 2
        //   readOnly: true
    });
</script>
<script>
    //ã‚³ãƒ¡ãƒ³ãƒˆä½œæˆ
    $('.comment').on('submit', function (e) {
        e.preventDefault();
        var comm = $('.comment-contents').val();

        $.ajax({
            url: "/cosmetics/<%= @cosmetic.id %>/comments",
            method: 'POST',
            data: {
                contents: comm
            }
        });
    })
    //ãƒšãƒ¼ã‚¸ã‚’Reroadã™ã‚‹ãŸã‚ã®document
    //ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤
    $(document).on('click', '.destroy-comment', function () {
        var comment_id = $(this).attr('data-id');

        $.ajax({
            url: "/cosmetics/comments/" + comment_id,
            method: "delete"
        })
    });

    //ã‚³ãƒ¡ãƒ³ãƒˆä¿®æ­£
    $(document).on('click', '.edit-comment', function () {
        if ($('.update-comment').length == 0) {
            var comment_id = $(this).data('id');
            var edit_comment = $(`.comment-detail-${comment_id}`);
            var contents = edit_comment.text().trim();
            edit_comment.html(`
        <input type="text" value="${contents}" class="form-control edit-comment-${comment_id}">`);
            $(this).text("ç¢ºèª").removeClass("edit-comment btn-primary").addClass("update-comment btn-warning");
        } else {
            alert("ä¿®æ­£ãŒã§ããªã„ã§ã™ã€‚");
        }
    });

    $(document).on('click', '.update-comment', function () {
        console.log("update");
        var comment_id = $(this).data('id');
        var comment_form = $(`.edit-comment-${comment_id}`);
        $.ajax({
            url: "/cosmetics/comments/" + comment_id,
            method: "patch",
            data: {
                contents: comment_form.val()
            }
        })
    });
</script>